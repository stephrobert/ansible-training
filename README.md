
# Ansible Training

Bienvenue dans ce projet **Ansible Training** !

Ce d√©p√¥t propose un parcours didactique et progressif pour d√©couvrir et
ma√Ætriser **Ansible**, de l‚Äôautomatisation basique √† l‚Äôorchestration avanc√©e. √Ä
travers des exercices pratiques et des exemples concrets, vous apprendrez √†
g√©rer vos infrastructures, d√©ployer des applications et orchestrer des
environnements complexes.

Ce n‚Äôest pas un cours acad√©mique, mais plut√¥t un guide pour vous accompagner
dans votre mont√©e en comp√©tences sur Ansible.

## üéØ Objectifs

- [**Comprendre les concepts fondamentaux
  d‚ÄôAnsible**](https://blog.stephane-robert.info/docs/infra-as-code/gestion-de-configuration/ansible/)
  : inventaire, ad-hoc, modules, playbooks.
- [**Apprendre √† √©crire des
  playbooks**](https://blog.stephane-robert.info/docs/infra-as-code/gestion-de-configuration/ansible/ecriture-de-playbooks-ansible/)
  clairs et modulaires en utilisant les bonnes pratiques YAML.
- [**Structurer et r√©utiliser votre
code**](https://blog.stephane-robert.info/docs/infra-as-code/gestion-de-configuration/ansible/ecrire-roles/)
via les r√¥les et les collections. -[ **G√©rer la s√©curit√© et les donn√©es
sensibles**](https://blog.stephane-robert.info/docs/infra-as-code/gestion-de-configuration/ansible/vault/)
avec Ansible Vault.
- [**Mettre en place des tests
  automatis√©s**](https://blog.stephane-robert.info/docs/infra-as-code/gestion-de-configuration/ansible/molecule-tox/)
  pour garantir la qualit√© de vos automatisations.
- ...

---

## üìö Structure du Projet

**TP Existants :**

- [`00-Introduction-Ansible`](./00-Introduction-Ansible) ‚Äî Pr√©sentation
  d‚ÄôAnsible, concepts fondamentaux (inventaires, modules, ad-hoc, YAML).
- [`01-Inventaires-Statiques`](./01-Inventaires-Statiques) ‚Äî Introduction √†
  Ansible, installation, configuration de l‚Äôinventaire, commandes ad-hoc.
- [`02-Playbooks`](./02-Playbooks) ‚Äî R√©daction de playbooks simples, t√¢ches,
  variables, gestion des handlers et conditions.
- [`03-Handlers`](./03-Handlers) ‚Äî Utilisation des handlers pour ex√©cuter des
  actions conditionnelles, gestion des modifications de configuration.
- [`04-Templates`](./04-Templates) ‚Äî Utilisation avanc√©e des variables (groupes,
  h√¥tes, fichiers vars), Jinja2 et templates pour la g√©n√©ration dynamique de
  fichiers.
- [`05-Inventaires-Dynamiques`](./05-Inventaires-Dynamiques) ‚Äî Cr√©ation
  d‚Äôinventaires dynamiques, int√©gration avec des services cloud (AWS, Azure,
  GCP), gestion des groupes dynamiques.
- [`06-Conditions`](./06-Conditions) ‚Äî Utilisation des conditions (`when`) pour
  contr√¥ler l‚Äôex√©cution des t√¢ches en fonction de variables et de faits syst√®me.
- [`07-Roles`](./07-Roles) ‚Äî Structuration du code : cr√©ation, organisation et
  r√©utilisation de r√¥les Ansible, bonnes pratiques.
- [`08-Blocks`](./08-Blocks) ‚Äî Utilisation des blocks pour regrouper des t√¢ches
  et g√©rer les erreurs.
- [`09-Vault`](./09-Vault) ‚Äî Chiffrement des donn√©es sensibles avec Ansible
  Vault, bonnes pratiques de s√©curisation.
- [`10-Customs-Facts`](./10-Customs-Facts) ‚Äî D√©finition et utilisation de faits
  personnalis√©s (custom facts) pour adapter les playbooks aux caract√©ristiques
  des h√¥tes.
- [`11-Custom-Facts`](./11-Custom-Facts) ‚Äî Cr√©ation et Utilisastion des faits
  personnalis√©s (custom facts) pour adapter les playbooks aux caract√©ristiques
  des h√¥tes.
- [`12-Lookup`](./12-Lookup) ‚Äî Utilisation des lookups pour r√©cup√©rer des
  donn√©es externes (fichiers, variables d‚Äôenvironnement, r√©sultats de commandes,
  APIs) dans les playbooks.
- [`13-Taches-Asynchrones`](./13-Taches-Asynchrones) ‚Äî Gestion des t√¢ches
  asynchrones dans Ansible : ex√©cution parall√®le, suivi des t√¢ches, etc.

TP en cours de r√©alisation :

- [`14-Molecule`](./14-Molecule) ‚Äî Mise en place de tests automatis√©s
  avec Molecule et Tox pour valider les r√¥les Ansible.
- [`15-Collections`](./15-Collections) ‚Äî Cr√©ation et utilisation de collections
  Ansible pour regrouper r√¥les, plugins et modules.
- [`16-Tests`](./16-Tests) ‚Äî Mise en place de tests automatis√©s pour valider les
  r√¥les et playbooks Ansible.
- [`17-Advanced`](./17-Advanced) ‚Äî Mise en pratique sur un cas concret
  de configuration compl√®te avec Ansible.

---

## üîß Pr√©requis

Ansible ne peut √™tre install√©, en th√©orie, que sur des ordinateurs fonctionnant
sur les syst√®mes d‚Äôexploitation **Linux** et **MacOS**. Pour ces TP, nous utiliserons
une machine Linux.

La mani√®re la plus propre pour installer Ansible se fait avec `pipx`. `pipx`
est un gestionnaire de paquets Python qui permet d'installer des applications
Python dans des environnements isol√©s, ce qui est particuli√®rement utile pour
√©viter les conflits de d√©pendances entre diff√©rentes applications Python.

### Installation de `pipx`

Pour installer `pipx`, vous devez d'abord installer `pip` si ce n'est pas d√©j√†
fait. `pip` est le gestionnaire de paquets Python standard. Vous pouvez
installer `pip` en utilisant le gestionnaire de paquets de votre syst√®me
d'exploitation.

* **Sur MacOS** :

```bash
brew install pipx
pipx ensurepath
sudo pipx ensurepath --global # optional to allow pipx actions with --global argument
```

* **Sur Debian/Ubuntu** :

```bash
sudo apt update
sudo apt install pipx
pipx ensurepath
sudo pipx ensurepath --global # optional to allow pipx actions with --global argument
```

* **Sur Fedora** :

```bash
sudo dnf install pipx
pipx ensurepath
sudo pipx ensurepath --global # optional to allow pipx actions with --global argument
```

* **Sur Arch Linux** :

```bash
sudo pacman -S python-pipx
pipx ensurepath
sudo pipx ensurepath --global # optional to allow pipx actions with --global argument
```

### Installation d' Ansible avec `pipx`

Maintenant que `pipx` est install√©, vous pouvez installer Ansible et les outils de test en utilisant
la commande suivante :

```bash
pipx install --include-deps ansible
pipx install ansible-lint
pipx install pytest
pipx inject pytest pytest-testinfra
```

### Test apr√®s installation d‚ÄôAnsible

Comment ex√©cuter Ansible ? Il suffit de taper la commande suivante qui va
simplement lancer en local (-c local) un shell qui ex√©cutera la commande `echo
'salut B0B'`:

```bash
ansible all -i "localhost," -c local -m shell -a 'echo Salut B0B'

localhost | success | rc=0 >>
salut B0B
```

### Installation d'Incus

L'installation d'**Incus** est assez simple et peut √™tre effectu√©e sur plusieurs
distributions Linux, telles qu'Ubuntu, Fedora et Gentoo. Voici les √©tapes de
base pour installer Incus sur les syst√®mes les plus courants.

* **Installation sur Ubuntu** :

Si vous utilisez une version r√©cente d'Ubuntu (24.04 LTS ou ult√©rieure), vous
pouvez installer Incus directement √† partir des d√©p√¥ts officiels. Voici les
√©tapes :

1. Mettez √† jour vos paquets :

   ```bash
   sudo apt update
   ```

2. Installez **Incus** avec la commande suivante :

   ```bash
   sudo apt install incus
   ```

3. Pour pouvoir g√©rer les machines virtuelles, installez √©galement **QEMU** :

   ```bash
   sudo apt install qemu-system
   ```

4. Si vous migrez depuis **LXD**, vous pouvez installer l‚Äôoutil de migration :

   ```bash
   sudo apt install incus-tools
   ```

* **Installation sur Fedora** :

1. Installez le plugin **COPR** pour dnf :

   ```bash
   sudo dnf install 'dnf-command(copr)'
   ```

2. Activez le d√©p√¥t COPR pour Incus :

   ```bash
   sudo dnf copr enable ganto/lxc4
   ```

3. Installez **Incus** :

   ```bash
   sudo dnf install incus
   ```

#### Autoriser `incus` pour votre utilisateur

Pour autoriser votre utilisateur √† utiliser `incus` sans √™tre forc√© de passer par l'utilisateur `root`, vous pouvez ex√©cuter les
commande suivante :

1. Ajouter les groupes n√©cessaires pour `incus`

   ```bash
   # Penser √† remplacer <username> par votre utilisateur
   sudo usermod -a -G incus <username>
   sudo usermod -a -G incus-admin <username>
   ```

2. Red√©marrer la machine pour prendre en compte l'ajout dans les groupes

   Le red√©marrage du service ne semble pas suffisant pour prendre en compte les changements de groupes. Cependant, suivant la distribution cette commande devrait suffire.

   ```bash
   sudo systemctl restart incus
   # Sinon
   sudo init 6
   ```

3. Apr√®s red√©marrage, initialiser `incus`

   ```bash
   incus admin init
   ```

4. V√©rifier la prise en compte des droits

   ```bash
   incus list

   +------+-------+------+------+------+-----------+
   | NAME | STATE | IPV4 | IPV6 | TYPE | SNAPSHOTS |
   +------+-------+------+------+------+-----------+
   ```

#### V√©rification de l'installation

Pour v√©rifier que l'installation s'est bien d√©roul√©e, vous pouvez ex√©cuter la
commande suivante :

```bash
incus version

Client version: 6.0.0
Server version: 6.0.0
```

### Alternative avec Docker

Si vous pr√©f√©rez utiliser Docker plut√¥t que d'installer Ansible directement sur votre syst√®me, nous fournissons une image Docker pr√™te √† l'emploi avec tous les outils n√©cessaires et le lab pr√©-install√©.

#### Pr√©requis Docker

Assurez-vous d'avoir Docker install√© sur votre syst√®me :

* **Sur Ubuntu/Debian** :
https://docs.docker.com/engine/install/ubuntu/
https://docs.docker.com/engine/install/linux-postinstall/

* **Sur Fedora** :
https://docs.docker.com/engine/install/fedora/
https://docs.docker.com/engine/install/linux-postinstall/

* **Sur macOS/Windows** : Installez [Docker Desktop](https://www.docker.com/products/docker-desktop/)

#### Construction et utilisation de l'image

1. **Cloner le d√©p√¥t** (si ce n'est pas d√©j√† fait) :
   ```bash
   git clone https://github.com/stephrobert/ansible-training.git
   cd ansible-training
   ```

2. **Construire l'image Docker** :
   ```bash
   cd environments/docker
   docker build -t ansible-training .
   ```

3. **Lancer le conteneur interactif** :
   ```bash
   docker run -it --rm ansible-training
   ```

4. **Ou monter un r√©pertoire local pour persister vos modifications** :
   ```bash
   docker run -it --rm -v $(pwd)/../../:/workspace ansible-training
   ```

#### Contenu de l'environnement Docker

L'image Docker inclut :
- **Ansible** (derni√®re version stable)
- **ansible-lint** pour la validation des playbooks
- **pytest** et **pytest-testinfra** pour les tests
- **Git** pour le versioning
- **Le lab complet** pr√©-install√© dans `/home/lab-user/ansible-training`
- Un utilisateur non-root `lab-user` pour plus de s√©curit√©

#### Avantages de l'approche Docker

- ‚úÖ **Isolation compl√®te** : aucun impact sur votre syst√®me h√¥te
- ‚úÖ **Reproductibilit√©** : environnement identique pour tous
- ‚úÖ **Pr√™t √† l'emploi** : tous les outils pr√©-install√©s et configur√©s
- ‚úÖ **Multi-plateforme** : fonctionne sur Linux, macOS et Windows
- ‚úÖ **Nettoyage facile** : suppression simple du conteneur

---

## üöÄ D√©marrage rapide

1. **Cloner le d√©p√¥t** :

   ```bash
   git clone https://github.com/stephrobert/ansible-training.git
   cd ansible-training
   ```

2. **Commencez par le dossier `00-Introduction-Ansible` pour vous familiariser
   avec les concepts et le vocabulaire propre √† Ansible.**
3. **Ensuite poursuivez avec les autres dossiers dans l‚Äôordre indiqu√©.**

---

## üîÑ Mise √† jour du d√©p√¥t

Je continuerai √† enrichir ce d√©p√¥t avec de nouveaux exercices, exemples et
am√©liorations. Pour r√©cup√©rer les derni√®res modifications depuis la branche
`main`, ex√©cutez :

```bash
git pull origin main
```

---

## ü§ù Contribuer

Vos retours, corrections et suggestions sont les bienvenus !

1. Cr√©ez une **issue** pour signaler un bug, proposer une am√©lioration ou poser
   une question.
2. Forkez le d√©p√¥t et ouvrez une **pull request** pour soumettre vos
   modifications (nouvelle section, corrections orthographiques, nouveaux
   exercices, etc.).

Consultez le fichier [`CONTRIBUTING.md`](./contributing.md) pour en savoir plus
sur les bonnes pratiques de contribution.

---

## ‚òï Me soutenir

Si vous trouvez ce guide utile et souhaitez me soutenir, vous pouvez me offrir
un caf√© :

[![Ko-fi](https://www.ko-fi.com/img/githubbutton_sm.svg)](https://ko-fi.com/votre-identifiant)

---

## ¬© Copyright et licence

- **Auteur** : St√©phane Robert (2025)
- **Licence** : [Creative Commons BY-SA
  4.0](https://creativecommons.org/licenses/by-sa/4.0/)

![Creative Commons
BY-SA](https://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-sa.png)
